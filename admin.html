<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Suhaila Local's Experience</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            font-family: 'Inter', Arial, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e0e7ef 100%);
            color: #22223b;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            max-width: 100%;
        }
        .admin-hero {
            background: linear-gradient(rgba(44,62,80,0.65), rgba(44,62,80,0.65)),
                        url('admin-hero.jpg') no-repeat center center/cover;
            color: #fff;
            padding: 6rem 1rem 4rem 1rem;
            border-radius: 0 0 40px 40px;
            box-shadow: 0 8px 32px #3a86ff22;
            text-align: center;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
            background-attachment: fixed;
            background-size: cover;
        }
        .admin-hero h1 {
            font-size: 3rem;
            color: #fff;
            margin-bottom: 1rem;
            letter-spacing: 0.02em;
            text-shadow: 0 2px 16px #23294688;
            font-family: 'Playfair Display', serif;
            opacity: 0;
            transform: translateY(40px);
            animation: slideInUp 1.1s 0.2s cubic-bezier(.6,.2,.2,1) forwards;
        }
        .admin-hero p {
            font-size: 1.3rem;
            color: #f1f3f8;
            font-weight: 500;
            margin-bottom: 0;
            opacity: 0;
            transform: translateY(40px);
            animation: fadeInUp 1.1s 0.5s cubic-bezier(.6,.2,.2,1) forwards;
        }
        .navbar {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            background: linear-gradient(90deg, #3a86ff 0%, #4361ee 100%);
            padding: 12px 0;
            position: sticky;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 2px 12px rgba(58,134,255,0.08);
        }
        .navbar a {
            color: #fff;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: 600;
            letter-spacing: 0.02em;
            margin: 0 8px;
            transition: background 0.2s, color 0.2s;
        }
        .navbar a.active,
        .navbar a:focus {
            background: #ffd60a;
            color: #22223b;
        }
        .navbar a:hover {
            background: #bde0fe;
            color: #3a86ff;
        }
        .admin-container {
            max-width: 1100px;
            margin: 40px auto 30px auto;
            padding: 32px 18px;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 4px 24px rgba(67,97,238,0.09);
        }
        h1 {
            text-align: center;
            font-size: 2.2em;
            margin-bottom: 0.5em;
            color: #3a86ff;
        }
        .admin-tabs {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 32px;
        }
        .admin-tab {
            background: #e0e7ef;
            border: none;
            padding: 12px 32px;
            border-radius: 8px 8px 0 0;
            font-size: 1.1em;
            font-weight: 600;
            color: #3a86ff;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }
        .admin-tab.active, .admin-tab:hover {
            background: #3a86ff;
            color: #fff;
        }
        .admin-section {
            display: none;
            animation: fadeIn 0.7s;
        }
        .admin-section.active {
            display: block;
        }
        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(40px);}
            to { opacity: 1; transform: translateY(0);}
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px);}
            to { opacity: 1; transform: translateY(0);}
        }
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 24px;
            background: #f8fafc;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px #bde0fe33;
        }
        .admin-table th, .admin-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #e0e7ef;
            text-align: left;
        }
        .admin-table th {
            background: #3a86ff;
            color: #fff;
            font-weight: 700;
        }
        .admin-table tr:last-child td {
            border-bottom: none;
        }
        .admin-table button {
            background: #d90429;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 6px 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        .admin-table button:hover {
            background: #b3001b;
        }
        .admin-form {
            background: #f8fafc;
            padding: 20px 18px;
            border-radius: 10px;
            box-shadow: 0 2px 8px #bde0fe33;
            margin-bottom: 24px;
        }
        .admin-form h3 {
            margin-top: 0;
            color: #3a86ff;
        }
        .admin-form label {
            display: block;
            margin: 12px 0 4px 0;
            font-weight: 600;
        }
        .admin-form input, .admin-form textarea {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #bde0fe;
            margin-bottom: 10px;
            font-size: 1em;
            font-family: inherit;
        }
        .admin-form button {
            background: #3a86ff;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 10px 24px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        .admin-form button:hover {
            background: #4361ee;
        }
        .admin-actions {
            text-align: right;
            margin-top: 24px;
        }
        .admin-actions button {
            background: #ffd60a;
            color: #22223b;
            border: none;
            border-radius: 6px;
            padding: 10px 24px;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.2s;
        }
        .admin-actions button:hover {
            background: #ffe066;
        }
        /* Login Modal */
        #loginModal {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: rgba(248,250,252,0.98);
            z-index: 9999;
        }
        #loginModal > div {
            background: #fff;
            padding: 32px 24px;
            border-radius: 12px;
            box-shadow: 0 2px 12px #3a86ff22;
            text-align: center;
            min-width: 320px;
        }
        #loginModal h2 {
            color: #3a86ff;
        }
        #loginModal input[type="password"] {
            padding: 10px;
            width: 220px;
            border-radius: 6px;
            border: 1px solid #bde0fe;
            margin-top: 10px;
            font-size: 1em;
        }
        #loginModal button {
            margin-top: 18px;
            padding: 10px 24px;
            border-radius: 6px;
            background: #3a86ff;
            color: #fff;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: background 0.2s;
        }
        #loginModal button:hover {
            background: #4361ee;
        }
        #loginError {
            color: #d90429;
            margin-top: 10px;
        }
        @media (max-width: 700px) {
            .admin-container {
                padding: 8px 2vw;
            }
            #loginModal > div {
                min-width: 90vw;
            }
        }
    </style>
</head>
<body>
    <header class="admin-hero">
        <h1>Admin Dashboard</h1>
        <p>Manage messages, blog posts, and products for Suhaila Local's Experience.</p>
    </header>
    <nav class="navbar">
        <a href="index.html">Home</a>
        <a href="admin.html" class="active" aria-current="page">Admin</a>
    </nav>
    <div class="admin-container" id="adminContainer" style="display:none;">
        <div class="admin-tabs">
            <button class="admin-tab active" onclick="showTab('messages')">Messages</button>
            <button class="admin-tab" onclick="showTab('blog')">Blog Posts</button>
            <button class="admin-tab" onclick="showTab('products')">Products</button>
        </div>
        <!-- Messages Section -->
        <div class="admin-section active" id="messages">
            <h2>Contact Messages</h2>
            <table class="admin-table" id="messagesTable">
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Message</th>
                    <th>Delete</th>
                </tr>
            </table>
        </div>
        <!-- Blog Posts Section -->
        <div class="admin-section" id="blog">
            <h2>Manage Blog Posts</h2>
            <table class="admin-table" id="blogTable">
                <tr>
                    <th>Title</th>
                    <th>Date</th>
                    <th>Delete</th>
                </tr>
            </table>
            <form class="admin-form" id="blogForm">
                <h3>Add New Blog Post</h3>
                <label for="blog-title">Title</label>
                <input type="text" id="blog-title" name="blog-title" required>
                <label for="blog-content">Content</label>
                <textarea id="blog-content" name="blog-content" rows="4" required></textarea>
                <button type="submit">Add Post</button>
                <div id="blogFormMsg" style="margin-top:10px;"></div>
            </form>
        </div>
        <!-- Products Section -->
        <div class="admin-section" id="products">
            <h2>Edit Products</h2>
            <table class="admin-table" id="productsTable">
                <tr>
                    <th>Product</th>
                    <th>Price</th>
                    <th>Delete</th>
                </tr>
            </table>
            <form class="admin-form" id="productForm">
                <h3>Add New Product</h3>
                <label for="product-name">Product Name</label>
                <input type="text" id="product-name" name="product-name" required>
                <label for="product-price">Price</label>
                <input type="text" id="product-price" name="product-price" required>
                <button type="submit">Add Product</button>
            </form>
        </div>
        <div class="admin-actions">
            <button onclick="logout()">Logout</button>
        </div>
    </div>
    <!-- Simple login modal -->
    <div id="loginModal">
        <div>
            <h2>Admin Login</h2>
            <input type="password" id="adminPassword" placeholder="Enter admin password">
            <br>
            <button onclick="login()">Login</button>
            <div id="loginError"></div>
        </div>
    </div>
    <script>
        // --- Simple client-side authentication ---
        const ADMIN_PASSWORD = "ACTact123";
        function login() {
            const input = document.getElementById('adminPassword').value;
            if (input === ADMIN_PASSWORD) {
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('adminContainer').style.display = '';
                loadAllData();
            } else {
                document.getElementById('loginError').textContent = "Incorrect password.";
            }
        }
        function logout() {
            document.getElementById('adminContainer').style.display = 'none';
            document.getElementById('loginModal').style.display = 'flex';
            document.getElementById('adminPassword').value = '';
        }

        // --- Tab switching ---
        function showTab(tab) {
            document.querySelectorAll('.admin-tab').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.admin-section').forEach(sec => sec.classList.remove('active'));
            document.querySelector('.admin-tab[onclick*="' + tab + '"]').classList.add('active');
            document.getElementById(tab).classList.add('active');
        }

        // --- Fetch and render data ---
        async function loadAllData() {
            await Promise.all([loadMessages(), loadBlog(), loadProducts()]);
        }

        async function loadMessages() {
            const res = await fetch('/api/messages');
            const data = await res.json();
            const table = document.getElementById('messagesTable');
            table.innerHTML = `<tr>
                <th>Name</th><th>Email</th><th>Message</th><th>Delete</th>
            </tr>`;
            data.forEach(msg => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${msg.name}</td>
                    <td>${msg.email}</td>
                    <td>${msg.message}</td>
                    <td><button onclick="deleteMessage('${msg.
                        id || msg.id}')">Delete</button></td>
                `;
                table.appendChild(row);
            });
        }
        async function deleteMessage(id) {
            await fetch('/api/messages/' + id, { method: 'DELETE' });
            loadMessages();
        }

        async function loadBlog() {
            const res = await fetch('/api/blog');
            const data = await res.json();
            const table = document.getElementById('blogTable');
            table.innerHTML = `<tr>
                <th>Title</th><th>Date</th><th>Delete</th>
            </tr>`;
            data.forEach(post => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${post.title}</td>
                    <td>${new Date(post.date).toLocaleDateString()}</td>
                    <td><button onclick="deleteBlog('${post.id}')">Delete</button></td>
                `;
                table.appendChild(row);
            });
        }
        async function deleteBlog(id) {
            await fetch('/api/blog/' + id, { method: 'DELETE' });
            loadBlog();
        }

        async function loadProducts() {
            const res = await fetch('/api/products');
            const data = await res.json();
            const table = document.getElementById('productsTable');
            table.innerHTML = `<tr>
                <th>Product</th><th>Price</th><th>Delete</th>
            </tr>`;
            data.forEach(prod => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${prod.name}</td>
                    <td>${prod.price}</td>
                    <td><button onclick="deleteProduct('${prod._id || prod.id}')">Delete</button></td>
                `;
                table.appendChild(row);
            });
        }
        async function deleteProduct(id) {
            await fetch('/api/products/' + id, { method: 'DELETE' });
            loadProducts();
        }

        // --- Add new blog post ---
        document.getElementById('blogForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const title = document.getElementById('blog-title').value.trim();
            const content = document.getElementById('blog-content').value.trim();
            const msgDiv = document.getElementById('blogFormMsg');
            msgDiv.textContent = '';
            if (!title || !content) {
                msgDiv.textContent = 'Please fill in both fields.';
                msgDiv.style.color = 'red';
                return;
            }
            try {
                const res = await fetch('/api/blog', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, content })
                });
                if (res.ok) {
                    msgDiv.textContent = 'Blog post added!';
                    msgDiv.style.color = 'green';
                    this.reset();
                    loadBlog();
                } else {
                    msgDiv.textContent = 'Failed to add post.';
                    msgDiv.style.color = 'red';
                }
            } catch (err) {
                msgDiv.textContent = 'Error connecting to server.';
                msgDiv.style.color = 'red';
            }
        });

        // --- Add new product ---
        document.getElementById('productForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const name = document.getElementById('product-name').value;
            const price = document.getElementById('product-price').value;
            await fetch('/api/products', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, price })
            });
            this.reset();
            loadProducts();
        });

        // Prevent FOUC: Hide admin until login
        document.getElementById('adminContainer').style.display = 'none';

        // Optional: Enter key submits login
        document.getElementById('adminPassword').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') login();
        });
    </script>
</body>
</html>